document.addEventListener("alpine:init",()=>{Alpine.data("analyticsComponent",()=>({totalRevenue:0,todayRevenue:0,todayOrders:0,todayCustomers:0,growth:0,paymentBreakdown:{cod:0,momo:0},revenueData:[],recentOrders:[],topCategories:[],async init(){await this.loadAllData(),this.initRevenueChart()},async loadAllData(){try{const[e,r,o,t]=await Promise.all([fetch("/api/analytics/summary").then(a=>a.json()),fetch("/api/analytics/revenue-daily").then(a=>a.json()),fetch("/api/orders?limit=10").then(a=>a.json()),fetch("/api/analytics/top-categories").then(a=>a.json())]);this.totalRevenue=e.totalRevenueAllTime||0,this.todayRevenue=e.todayRevenue||0,this.todayOrders=e.todayOrders||0,this.todayCustomers=e.todayCustomers||0,this.growth=e.growth||0,this.paymentBreakdown=e.paymentBreakdown||{cod:0,momo:0},this.revenueData=r,this.recentOrders=o.orders||[],this.topCategories=t}catch(e){console.error("Analytics load error:",e)}},initRevenueChart(){const e=this.revenueData.map(t=>t._id),o={series:[{name:"Doanh thu",data:this.revenueData.map(t=>t.revenue)}],chart:{type:"area",height:350,toolbar:{show:!1}},stroke:{curve:"smooth",width:3},fill:{type:"gradient",gradient:{opacityFrom:.6,opacityTo:0}},colors:["#4361ee"],xaxis:{categories:e,labels:{rotate:-45}},yaxis:{labels:{formatter:t=>t.toLocaleString()+"₫"}},tooltip:{y:{formatter:t=>t.toLocaleString()+" ₫"}}};new ApexCharts(document.getElementById("revenueChart"),o).render()},formatCurrency(e){return e.toLocaleString("vi-VN")+"₫"},formatPercentage(e){return e.toFixed(1)+"%"}}))});
