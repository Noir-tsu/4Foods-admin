document.addEventListener("alpine:init",()=>{Alpine.data("analyticsComponent",()=>({totalRevenue:0,todayRevenue:0,todayOrders:0,todayCustomers:0,growth:0,paymentBreakdown:{cod:0,momo:0},recentOrders:[],topCategories:[],revenueData:[],async init(){await this.fetchData(),this.$nextTick(()=>this.initCharts())},async fetchData(){try{const[e,r,o,t]=await Promise.all([fetch("/api/analytics/summary"),fetch("/api/analytics/revenue-daily"),fetch("/api/orders?limit=10"),fetch("/api/analytics/top-categories")]);if(!e.ok)throw new Error("Summary failed");if(!r.ok)throw new Error("Revenue daily failed");const a=await e.json(),s=await r.json(),n=await o.json(),i=await t.json();this.totalRevenue=a.totalRevenueAllTime||0,this.todayRevenue=a.todayRevenue||0,this.todayOrders=a.todayOrders||0,this.todayCustomers=a.todayCustomers||0,this.growth=a.growth||0,this.paymentBreakdown=a.paymentBreakdown||{cod:0,momo:0},this.recentOrders=n.orders||[],this.topCategories=i.slice(0,6),this.revenueData=s}catch(e){console.error("Analytics fetch error:",e)}},initCharts(){const e=document.getElementById("revenueChart");if(!e||!this.revenueData.length)return;const r=this.revenueData.map(t=>t._id),o=this.revenueData.map(t=>t.total);new ApexCharts(e,{series:[{name:"Doanh thu",data:o}],chart:{height:350,type:"area",toolbar:{show:!1}},colors:["#007bff"],stroke:{curve:"smooth",width:3},fill:{opacity:.15},xaxis:{categories:r,labels:{style:{colors:"#a1a1aa"}}},yaxis:{labels:{formatter:t=>"$"+(t/1e3).toFixed(0)+"k"}},tooltip:{y:{formatter:t=>"$"+t.toLocaleString()}}}).render()},formatCurrency(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e||0)},formatPercentage(e){return(e||0).toFixed(1)+"%"}}))});
